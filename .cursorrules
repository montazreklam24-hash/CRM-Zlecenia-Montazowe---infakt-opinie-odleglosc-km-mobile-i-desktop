# Reguły dla CRM Zlecenia Montażowe

## Git & Deploy
- Po każdej zmianie lub grupie zmian rób git commit
- Używaj konwencji: fix:, feat:, refactor:, chore:
- Wiadomości commitów opisowe (po polsku lub angielsku)
- ZAWSZE rób git push po commitach!
- **ZAWSZE po zmianach w kodzie rób `npm run build` aby zaktualizować folder dist/**
- **PO KAŻDYM BUILDZIE zaktualizuj folder `dist_ehost` kopiując do niego zawartość `dist/` (zachowując specyficzne pliki config w api/) oraz zsynchronizuj dist w dockerze.**

## Backup
- npm run build automatycznie robi backup ZIP przed buildem
- Backupy w folderze ../CRM-Backups/ (max 20 ostatnich)
- Można też ręcznie: npm run backup
- build:fast pomija backup (tylko gdy pilne)

## Deploy
- **Build ZAWSZE: npm run build**
- Folder dist/ wgrywać na FTP
- Folder dist_ehost/ utrzymywać jako lokalne odzwierciedlenie wersji online (ehost)
- NIE nadpisywać uploads/ na serwerze (zdjęcia klientów)

## Stack
- Frontend: React + TypeScript + Vite
- Backend: PHP 5.6+ API (folder api/)
- Baza: MySQL
- UI: Tailwind CSS

## Konwencje kodu
- Komponenty React w src/components/
- Serwisy API w src/services/
- Typy w src/types.ts
- Polski język w UI, angielski w kodzie

## API
- Gemini: model gemini-1.5-flash
- Klucze w api/config.php

## Mapy (Google & OSM)
- ZAWSZE przy kliknięciu lub najechaniu (hover) na marker dymek/karta MUSI zostać wyśrodkowana na mapie.
- W Google Maps używaj `googleMapRef.current.panTo(marker.getPosition())`. WAŻNE: Nie dodawaj listenera `bounds_changed`, który czyści stan dymka, bo `panTo` go wywoła i zamknie dymek.
- W OSM używaj `autoPan: false` w `bindPopup` i ręcznie wywołuj `map.panTo(marker.getLatLng())` w zdarzeniach `mouseover` i `click`.
- To kluczowe dla UX na urządzeniach mobilnych i małych ekranach.

## Workflow po zmianach w kodzie:
1. Wprowadź zmiany w src/
2. git add .
3. git commit -m "typ: opis zmiany"
4. git push
5. **npm run build** (ZAWSZE!)
6. **Aktualizacja dist_ehost**: Skopiuj zawartość `dist/` do `dist_ehost/`.
7. Folder dist/ jest gotowy do wgrania na serwer oraz do użycia w dockerze.

## Zasady dla agenta (Terminal & CWD)
- **ABSOLUTNY ZAKAZ pracy na dysku C:** Projekt znajduje się na dysku D. Przed każdą komendą `npm` lub `git` upewnij się, że jesteś na dysku D w poprawnym folderze.
- **Zawsze wymuszaj ścieżkę:** Jeśli terminal startuje w `C:\Users\...`, wykonaj `d:; cd "D:\Programowanie\Cursor\CRM Zlecenia Montazowe - infakt, opinie, odleglosc km, mobile i desktop"`.
- **Weryfikacja:** Po każdym buildzie sprawdź `Get-Location` lub `pwd` aby mieć pewność, że pliki powstały w `D:\...\dist`.
- **Vite Port**: Zawsze używamy portu 3000. Jeśli zajęty - znajdź i ubij proces.
